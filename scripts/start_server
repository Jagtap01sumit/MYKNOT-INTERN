#!/bin/bash

# Give permission for everything in the express-app directory
sudo chmod -R 777 /home/ec2-user/express-app

# Navigate into our working directory where we have all our files
cd /home/ec2-user/express-app/server

# Add npm and node to path using NVM (Node Version Manager)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # Loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # Loads nvm bash_completion (Node is in the path now)

# Install Node.js modules using npm
npm install

# Start your Node.js server using "npm start server.js"
npm start server.js > server.out.log 2> server.err.log < /dev/null &

# Optionally, you can also log the process ID (PID) of the running server
# This can be useful for stopping or managing the background process
echo $! > server.pid
